#!/bin/bash

# Run triggers only on updates
if [ ! -e "/usr/local/linkpanel/data/users/admin" ]; then
	exit
fi

if [ ! -e "/etc/linkpanelcp/linkpanel.conf" ]; then
	mkdir -p /etc/linkpanelcp
	echo -e "# Do not edit this file, will get overwritten on next upgrade, use /etc/linkpanelcp/local.conf instead\n\nexport LINKPANEL='/usr/local/linkpanel'\n\n[[ -f /etc/linkpanelcp/local.conf ]] && source /etc/linkpanelcp/local.conf" > /etc/linkpanelcp/linkpanel.conf
fi

# Configure apt to retry downloading on error
if [ ! -f /etc/apt/apt.conf.d/80-retries ]; then
	echo "APT::Acquire::Retries \"3\";" > /etc/apt/apt.conf.d/80-retries
fi

# Validate version number and replace if different
LINKPANEL_V=$(dpkg -s linkpanel | grep -i version | awk '{ print $2 }')
